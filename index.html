<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI FORGE CV | Pro Edition</title>
    <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;700;900&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    
    <style>
        :root { --accent: #38bdf8; --dark: #0f172a; --gray: #f8fafc; }
        body { font-family: 'Cairo', sans-serif; background: #e2e8f0; margin: 0; padding-bottom: 50px; }
        .container { max-width: 900px; margin: 20px auto; background: white; padding: 25px; border-radius: 15px; box-shadow: 0 10px 25px rgba(0,0,0,0.1); }
        .section-title { color: var(--accent); border-bottom: 2px solid #eee; padding-bottom: 5px; margin: 20px 0 15px; font-weight: 900; }
        .grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px; }
        input, textarea { width: 100%; padding: 12px; border: 1px solid #ddd; border-radius: 8px; font-family: inherit; box-sizing: border-box; }
        
        .dl-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(120px, 1fr)); gap: 10px; margin-top: 20px; }
        .btn { border: none; padding: 12px; border-radius: 8px; color: white; cursor: pointer; font-weight: bold; transition: 0.3s; }
        .btn-ar { background: var(--dark); } .btn-en { background: #0284c7; } .btn-fr { background: #e11d48; }
        
        /* PDF Preview Styling */
        #pdf-wrap { position: absolute; top: -10000px; left: -10000px; width: 210mm; min-height: 297mm; display: flex; background: white; }
        .pdf-side { width: 70mm; background: var(--dark); color: white; padding: 30px 20px; }
        .pdf-content { flex: 1; padding: 40px; }
        .pdf-h { font-size: 18px; font-weight: 900; color: var(--dark); border-bottom: 2px solid var(--accent); margin: 20px 0 10px; padding-bottom: 5px; }
        .rtl { direction: rtl; text-align: right; } .ltr { direction: ltr; text-align: left; }
        .ltr .pdf-h { border-left: none; }
        
        #loader { display: none; position: fixed; inset: 0; background: rgba(255,255,255,0.9); z-index: 10000; flex-direction: column; align-items: center; justify-content: center; }
    </style>
</head>
<body>

<div id="loader">
    <i class="fas fa-spinner fa-spin fa-3x" style="color: var(--accent);"></i>
    <h3 id="loader-text">جاري المعالجة...</h3>
</div>

<div class="container">
    <h2 style="text-align: center; color: var(--dark);">AI FORGE CV <i class="fas fa-gem"></i></h2>
    
    <div class="section-title">المعلومات الشخصية</div>
    <div class="grid">
        <input type="text" id="inName" placeholder="الاسم بالكامل">
        <input type="text" id="inJob" placeholder="المسمى الوظيفي" oninput="autoFill()">
        <input type="text" id="inPhone" placeholder="رقم الهاتف">
        <input type="text" id="inEmail" placeholder="البريد الإلكتروني">
        <input type="text" id="inAddress" placeholder="العنوان">
        <input type="text" id="inBirth" placeholder="تاريخ الميلاد">
        <input type="text" id="inMilitary" placeholder="الموقف من التجنيد">
        <input type="file" id="inPhoto">
    </div>

    <div class="section-title">المحتوى والخبرات</div>
    <textarea id="inAbout" rows="3" placeholder="نبذة عنك"></textarea>
    <textarea id="inExp" rows="4" placeholder="الخبرات العملية" style="margin-top:10px;"></textarea>
    <textarea id="inEdu" rows="3" placeholder="التعليم والشهادات" style="margin-top:10px;"></textarea>

    <div class="section-title">المهارات واللغات (ستظهر في الجزء الأبيض)</div>
    <div class="grid">
        <textarea id="inSkills" placeholder="المهارات (مثال: قيادة، برمجة، إدارة)"></textarea>
        <textarea id="inLang" placeholder="اللغات (مثال: عربية، إنجليزية)"></textarea>
    </div>

    <div class="dl-grid">
        <button class="btn btn-ar" onclick="build('ar')">تحميل بالعربية</button>
        <button class="btn btn-en" onclick="build('en')">English</button>
        <button class="btn btn-fr" onclick="build('fr')">Français</button>
        <button class="btn btn-it" onclick="build('it')">Italiano</button>
        <button class="btn btn-es" onclick="build('es')">Español</button>
        <button class="btn btn-de" onclick="build('de')">Deutsch</button>
    </div>
</div>

<div id="pdf-wrap">
    <div class="pdf-side">
        <div style="width:120px; height:120px; border-radius:50%; border:4px solid var(--accent); margin:0 auto 20px; overflow:hidden; background:#2d3748;">
            <img id="outPhoto" style="width:100%; height:100%; object-fit:cover;">
        </div>
        <div id="side-data"></div>
    </div>
    <div class="pdf-content">
        <h1 id="outName" style="margin:0; font-size:35px;"></h1>
        <h3 id="outJob" style="color:var(--accent); margin-top:5px;"></h3>
        
        <div class="pdf-h" id="h-about"></div>
        <div id="outAbout" style="font-size:13px; line-height:1.6;"></div>
        
        <div class="pdf-h" id="h-exp"></div>
        <div id="outExp" style="font-size:13px; line-height:1.6; white-space:pre-line;"></div>

        <div class="pdf-h" id="h-edu"></div>
        <div id="outEdu" style="font-size:13px; line-height:1.6; white-space:pre-line;"></div>

        <div class="pdf-h" id="h-skills"></div>
        <div id="outSkills" style="font-size:13px; line-height:1.6;"></div>

        <div class="pdf-h" id="h-lang"></div>
        <div id="outLang" style="font-size:13px; line-height:1.6;"></div>
    </div>
</div>

<script>
    const labels = {
        ar: { about:"النبذة الشخصية", exp:"الخبرة العملية", edu:"التعليم", skills:"المهارات", lang:"اللغات", contact:"اتصال", birth:"الميلاد", military:"التجنيد", wait:"جاري التحميل..." },
        en: { about:"Professional Summary", exp:"Work Experience", edu:"Education", skills:"Skills", lang:"Languages", contact:"Contact", birth:"Birth", military:"Military", wait:"Downloading..." }
    };

    function autoFill() {
        const job = document.getElementById('inJob').value;
        if(job.length > 3) {
            document.getElementById('inAbout').value = `خبير في مجال ${job}، أسعى دائماً لتطوير المهارات وتحقيق الأهداف المرجوة بكفاءة عالية.`;
            document.getElementById('inExp').value = `• العمل كـ ${job} لعدة سنوات.\n• تطوير استراتيجيات العمل وتحسين الإنتاجية.`;
            document.getElementById('inSkills').value = `مهارات الـ ${job}، العمل الجماعي، القيادة`;
        }
    }

    async function translate(text, lang) {
        if(!text || lang === 'ar') return text;
        try {
            const res = await fetch(`https://translate.googleapis.com/translate_a/single?client=gtx&sl=auto&tl=${lang}&dt=t&q=${encodeURI(text)}`);
            const json = await res.json();
            return json[0].map(s => s[0]).join('');
        } catch { return text; }
    }

    async function build(lang) {
        document.getElementById('loader').style.display = 'flex';
        const l = labels[lang] || labels['en'];
        const wrap = document.getElementById('pdf-wrap');
        wrap.className = (lang === 'ar') ? 'rtl' : 'ltr';

        // ترجمة وتعبئة
        document.getElementById('outName').innerText = await translate(document.getElementById('inName').value, lang);
        document.getElementById('outJob').innerText = await translate(document.getElementById('inJob').value, lang);
        document.getElementById('outAbout').innerText = await translate(document.getElementById('inAbout').value, lang);
        document.getElementById('outExp').innerText = await translate(document.getElementById('inExp').value, lang);
        document.getElementById('outEdu').innerText = await translate(document.getElementById('inEdu').value, lang);
        document.getElementById('outSkills').innerText = await translate(document.getElementById('inSkills').value, lang);
        document.getElementById('outLang').innerText = await translate(document.getElementById('inLang').value, lang);

        document.getElementById('h-about').innerText = l.about;
        document.getElementById('h-exp').innerText = l.exp;
        document.getElementById('h-edu').innerText = l.edu;
        document.getElementById('h-skills').innerText = l.skills;
        document.getElementById('h-lang').innerText = l.lang;

        const mil = await translate(document.getElementById('inMilitary').value, lang);
        document.getElementById('side-data').innerHTML = `
            <div style="margin-bottom:15px; border-bottom:1px solid #444; color:var(--accent); font-weight:bold;">${l.contact}</div>
            <div style="font-size:12px; margin-bottom:5px;">${document.getElementById('inPhone').value}</div>
            <div style="font-size:12px; margin-bottom:5px;">${document.getElementById('inEmail').value}</div>
            <div style="font-size:12px; margin-bottom:5px;">${document.getElementById('inAddress').value}</div>
            <div style="margin-top:15px; font-size:12px;"><b>${l.birth}:</b> ${document.getElementById('inBirth').value}</div>
            <div style="margin-top:5px; font-size:12px;"><b>${l.military}:</b> ${mil}</div>
        `;

        setTimeout(async () => {
            const canvas = await html2canvas(wrap, { scale: 3, useCORS: true });
            const doc = new jspdf.jsPDF('p', 'mm', 'a4');
            doc.addImage(canvas.toDataURL('image/png'), 'PNG', 0, 0, 210, 297);
            doc.save(`CV_${lang}.pdf`);
            document.getElementById('loader').style.display = 'none';
        }, 1000);
    }

    document.getElementById('inPhoto').onchange = e => {
        const reader = new FileReader();
        reader.onload = () => document.getElementById('outPhoto').src = reader.result;
        reader.readAsDataURL(e.target.files[0]);
    };
</script>
</body>
</html>
